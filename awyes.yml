# # -------------------------------------------------------------------
# # roles
# # -------------------------------------------------------------------

pastewin_role:
  get_role:
    client: iam
    depends_on:
      - pastewin_role.create_role
    args:
      RoleName: pastewin
  create_role:
    client: iam
    args:
      RoleName: pastewin
      Description: Role for pastewin
      AssumeRolePolicyDocument: >
        {
          "Version": "2012-10-17",
          "Statement": [{
            "Effect": "Allow",
            "Principal": { "Service": "lambda.amazonaws.com" },
            "Action": "sts:AssumeRole"
          }]
        }

pastewin_role_attach_s3:
  attach_role_policy:
    client: iam
    depends_on:
      - pastewin_role.get_role
    args:
      RoleName: pastewin
      PolicyArn: arn:aws:iam::aws:policy/AmazonS3FullAccess

# # -------------------------------------------------------------------
# # s3
# # -------------------------------------------------------------------

pastewin_bucket:
  create_bucket:
    client: s3
    args:
      Bucket: pastewin-pastes
      CreateBucketConfiguration:
        LocationConstraint: us-west-2
  put_public_access_block:
    client: s3
    depends_on:
      - pastewin_bucket.create_bucket
    args:
      Bucket: pastewin-pastes
      PublicAccessBlockConfiguration:
        BlockPublicAcls: False
        IgnorePublicAcls: False
        BlockPublicPolicy: False
        RestrictPublicBuckets: False
  put_bucket_policy:
    client: s3
    depends_on:
      - pastewin_bucket.create_bucket
    args:
      Bucket: pastewin-pastes
      Policy: >
        {
          "Id": "Policy1655709303217",
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "Stmt1655709300574",
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": "arn:aws:s3:::pastewin-pastes/*",
              "Principal": "*"
            }
          ]
        }
